
## 识别烟雾的挑战

- 形态多变: 烟雾没有固定的形状或长宽比。它可以是细长的烟柱，也可以是弥散的云团。
- 边界模糊： 烟雾从浓到淡逐渐过渡，哪里是“边界”非常主观。
- 标注不一致: 由于上述两点，不同的人，甚至同一个人在不同时间，对同一团烟雾的标注框都可能不一样。有的框可能很紧凑，只包围最浓密的部分；有的框可能很宽松，包含了周围稀薄的区域

## 8月份

- 8月1日 ：
  
        将deim、define推理代码完全适配到torch 1.10 和 python 3.7,经过测试，无问题。
        由于不知道烟雾决赛，工厂烟雾算不算烟，所以需要手动过滤下，目前测试集已经清洗完。
        测试集已经全部处理完成，基于yolov11_x、和deim_x模型进行训练
        研究了yolov11的类别损失、回归框损失、DFL损失，以及[DFL]的实现原理。
        DFL损失与传统损失只预测一个框的坐标，但是DFL损失会预测一个分布，衡量的是与真实边界的微观差距，能够完美表达边界的不确定性，
        ```
        ----------------------------------------------------------------------------------------
        BaseLine 1:(AdamW  lr0 = 0.0001 close_mosaic = 10 img_size = 768 multi_scale=True CIOU 模型尺寸：L)
        
        Class     Images     Instances   Box(P         R       mAP50     mAP50-95     F1): 
        all       3930          2271     0.851      0.817      0.879      0.557      0.834
        Results saved to runs/smoke_train/YOLO11X-960-2
        ----------------------------------------------------------------------------------------
        在BaseLine 1试验基础之上，只修改模型中的GIOU为DIOU,WramUp 由1 设置为 3
              
        Class     Images  Instances    Box(P        R        mAP50   mAP50-95        F1)
        all       3930       2271      0.851      0.834      0.886      0.561      0.842
        runs/smoke_train/YOLO11X-768-DIOU
        ---------------------------------------------------------------------------------------
        在上面的基础上，优化器变更为SGD
        Class     Images  Instances      Box(P        R        mAP50   mAP50-95      F1):
        all       3930       2271       0.852        0.819      0.878      0.538    0.835
        Results saved to runs/smoke_train/YOLO11X-768-DIOU-SGD
        ---------------------------------------------------------------------------------------
        BaseLine 2:(AdamW  lr0 = 0.0001 close_mosaic = 10 img_size = 768 multi_scale=True  DIOU 模型尺寸：X)
        Class     Images  Instances      Box(P       R      mAP50   mAP50-95        F1): 
        all       3930       2271      0.848      0.836      0.882      0.568        0.842
        Results saved to runs/smoke_train/YOLO11X-768-DIOU-SGD3
        推理时 rect = True
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1945.0 | 489.0 |       2272      | 0.2009 | 0.8561 | 0.8677 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 86.77% |
        | precision |   -    |   -   |        -        |   -    |   -    | 79.91% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 85.61% |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        推理时 rect = False
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1970.0 | 539.0 |       2272      | 0.2148 | 0.8671 | 0.8716 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.16% |
        | precision |   -    |   -   |        -        |   -    |   -    | 78.52% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 86.71% |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        推理时 rect = False + WBF（iou=0.1 skip_box_threshold=0.25）
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1921.0 | 284.0 |       2272      | 0.1288 | 0.8455 | 0.8746 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.46% |
        | precision |   -    |   -   |        -        |   -    |   -    | 87.12% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 84.55% |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        推理时 rect = False + WBF（iou=0.01 skip_box_threshold=0.2）
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1932.0 | 287.0 |       2272      | 0.1293 | 0.8504 | 0.8763 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.63% |
        | precision |   -    |   -   |        -        |   -    |   -    | 87.07% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 85.04% |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        推理时 rect = False + WBF（iou=0.01 skip_box_threshold=0.1 conf_tyepe=max）
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1953.0 | 329.0 |       2272      | 0.1442 | 0.8596 | 0.8788 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.88% |
        | precision |   -    |   -   |        -        |   -    |   -    | 85.58% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 85.96% |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        推理时 rect = False + WBF（iou=0.01 skip_box_threshold=0.1 conf_tyepe=avg）
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
        +-----------+--------+-------+-----------------+--------+--------+--------+
        |   smoke   | 1953.0 | 329.0 |       2272      | 0.1442 | 0.8596 | 0.8818 |
        |           |        |       |                 |        |        |        |
        |    mAP    |   -    |   -   |        -        |   -    |   -    | 88.18% |
        | precision |   -    |   -   |        -        |   -    |   -    | 85.58% |
        |   recall  |   -    |   -   |        -        |   -    |   -    | 85.96% |
        +-----------+--------+-------+-----------------+--------+--------+--------+

        BaseLine 3:(AdamW  lr0 = 0.0001 close_mosaic = 15 img_size = 960 multi_scale=False DIOU 模型尺寸：L)
        Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
         all       3930       2271       0.864      0.821      0.879      0.548      0.842
        Results saved to runs/smoke_train/YOLO11-L-960-DIOU-AdamW
        ----------------------------------------------------------------------------------
        BaseLine 4:(AdamW  lr0 = 0.0001 close_mosaic = 15 img_size = 1024 multi_scale=False DIOU 模型尺寸：L)
          Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
          all       3930       2271      0.859      0.816      0.881      0.547      0.837
        ----------------------------------------------------------------------------------
        ```

- 8月4日 ：

      - 损失函数改进：
          - IOU：
            - 在不重叠的情况下，梯度会消失
            - 在不重叠的情况下预测框和GT框距离很远或很近，损失都是1；
            - 当两个框的IOU值相同时，他们的随其方式天差地别，一个好的损失函数应该能告诉模型那种对齐方式更好
          - GIOU: 通过引入包含预测框和真实框最小外接矩形的概念，但是当一个框完全包含另一个框时，会退化成IOU，无法区分相对位置关系，收敛速度慢（惩罚空隙面积）
          - DIOU: 在 GIoU 的基础上，直接考虑两个框的中心点距离，以解决 GIoU 收敛慢的问题(中心点距离)
          - CIOU: 在 DIoU 的基础上，增加对长宽比的考量，使回归更稳定、更精确（惩罚中心点距离+形状差异）
          - EIOU: 在 CIOU 的基础上，将长宽比惩罚项改为了直接惩罚宽和高的直接差异
          - WIOUV3: 训练数据中难以避免出现低质量示例（标注不完整、不准确），所以如距离、纵横比之类的几何度量都会加剧对低质量示例的惩罚从而使模型的泛化性能下降。好的损失函数应该在锚框与目标框较好地重合时削弱几何度量的惩罚
           ----------------------------------------------------------------------------------
           alpha = 1.7  delta = 2.7 WiseIOU-v3
           Class     Images  Instances      Box(P         R       mAP50     mAP50-95     F1)
           all       3930       2271         0.891      0.836      0.897      0.601      0.863
           Results saved to runs/smoke_train/YOLO11-L-768-WIOU-AdamW5
           -----------------------------------------------------------------------------------
           delta = 2.3    alpha = 2.0 WiseIOU-v3
           Class     Images  Instances      Box(P          R      mAP50   mAP50-95      F1)
           all       3930       2271      0.873      0.847      0.897      0.596       0.86
           Results saved to runs/smoke_train/YOLO11-L-768-WIOUV2-AdamW
           ------------------------------------------------------------------------------------
           alpha = 1.7  delta = 2.7 Wise-EIOU-v3 
           Class     Images  Instances      Box(P          R      mAP50   mAP50-95      F1)
           all       3930       2271       0.88       0.84      0.898      0.588      0.859
           Results saved to runs/smoke_train/YOLO11-L-768-W-EIOU-AdamW
           -----------------------------------------------------------------------------------
           alpha = 1.7  delta = 2.7 Wise-IOU-v2
           Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
           all       3930       2271         0.863      0.847      0.894      0.602      0.855
           Results saved to runs/smoke_train/YOLO11-L-768-WIOU_v2-AdamW
           -----------------------------------------------------------------------------------

- 8月5日 ：进行了四组补充试验，主要是测试wiou两个超参数对指标的影响，试验结果如上
  - 标签分配策略改进：ultralytics/utils/tal.py
    - 目的：为每个真实目标框选择最合适的锚点，同时考虑预测的分类得分和定位的准确性（IoU）。它通过一个加权的方式将分类得分和IoU结合起来，然后选择每个真实目标框对应的top-k个锚点作为候选，再经过一些筛选得到最终的分配结果。
    

  - 替换后处理为Soft-NMS、WBF(DEUG 推理代码)
    - 推理流程：ultralytics/engine/model.py：534行 -》 1086 -》ultralytics/engine/predictor.py:110行 ->160行-》ultralytics/nn/autobackend.py:607—》libs/ultralytics/engine/predictor.py：336 -》ultralytics/models/yolo/detect/predict.py:55
    - WBF通过保留多有有效检测框并加权合并，预期目标，同时调整标签分配策略，确保模型输出“多而精”的候选框，WBF将这些框融合为“准而全”的最终结果

- 8月6日 ：分析了四组针对wise-iou的试验结果，发现调增两个超参数影响不是很大，都不如论文中默认的参数，所以昨天就继续试着修改了整体框回归损失和分类损失所占的比重
  
  - 可变性卷积
  - 减少box_loss权重，提高class_loss、dfl_loss权重 
    ```
     ---------------------------------------------------------------------------------------
      alpha = 1.7  delta = 2.7 Wise-IOU-v3  box = 7.5, cls = 0.5, dfl = 1.5 
      Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1):
      all       3930       2271      0.891      0.836      0.897      0.601      0.863
      runs/smoke_train/YOLO11-L-768-WIOU_v3-Assigner-AdamW
    ----------------------------------------------------------------------------------------
     在上面参数的基础上，变更 box = 5, cls = 3, dfl = 2
     Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
      all       3930       2271      0.869      0.849       0.89      0.564      0.859
    ------------------------------------------------------------------------------------------
     在上面参数的基础上，变更 box = 5, cls = 3, dfl = 2,  变更正样本分配策略 alpha is 2.0 beta is 4.0 top-K is 15
     原因：当top-K变大后，很可能引入和太多模糊样本，让模型学习到更多有歧义的例子，干扰了学习过程。
          过度强调分类损失，会让模型关注那些有争议的样本，忽视了对清晰样本的学习。
     Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
     all       3930       2271      0.766       0.76      0.738      0.309      0.763
    -----------------------------------------------------------------------------------------
     转变思路，Wise-IOU v3 (alpha=1.7, delta=2.7) +  box = 7, cls = 1, dfl = 1.5, + top-K=12
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1):
    all       3930       2271        0.884      0.853        0.9      0.583      0.868
    Results saved to runs/smoke_train/YOLO11-L-768-WIOU_v3-Assigner2-AdamW3
    -----------------------------------------------------------------------------------------
     在上面参数的基础上 box = 7, cls = 1, dfl = 2, + top-K=12 alpha is 1 beta is 5.5 top-K=12   
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
    all       3930       2271        0.887      0.856      0.898      0.579      0.872
    Results saved to runs/smoke_train/YOLO11-L-768-WIOU_v3-Assigner2-AdamW4
    ----------------------------------------------------------------------------------
     在上面参数的基础上 box = 6.5, cls = 1.5, dfl = 2
     Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1):
     all       3930       2271      0.892      0.845        0.9      0.564      0.868
    Results saved to runs/smoke_train/YOLO11-L-768-WIOU_v3-Assigner2-AdamW5
    ----------------------------------------------------------------------------------
    box = 7, cls = 1, dfl = 2, + SGD  
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): *****************************
    all       3930       2271        0.898      0.849      0.899      0.581      0.873
    Results saved to runs/smoke_train/YOLO11-X-768-WIOU_v3-Assigner2-SGD
    ----------------------------------------------------------------------------------
    大尺寸960的试验，batch=128 lr=0.0005(上面都是0.0001) 其他超参数一样
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1):
    all       3930       2271       0.88      0.838      0.892      0.561        0.859
    Results saved to runs/smoke_train/YOLO11-X-960-WIOU_v3-Assigner2-SGD7
    ```

- 8月7日 ：CBAM模块实验

    box = 7, cls = 1, dfl = 2, + SGD
    rt-detr-x summary: 370 layers, 65,469,491 parameters, 0 gradients, 222.5 GFLOPs
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
    all       3930       2271        0.835        0.8       0.85      0.481      0.817
    Results saved to runs/smoke_train/DETR-X-768-WIOU_v3-Assigner2-SGD
    --------------------------------------------------------------------------------------
  - 颈部，融合前 添加CBAM注意力机制  box = 7, cls = 1, dfl = 2, + SGD  top-k = 12 wise_iou_v3
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
    all       3930       2271      0.874      0.824      0.875       0.49      0.848
    --------------------------------------------------------------------------------------
  - 颈部，融合后 添加CBAM注意力机制  box = 7, cls = 1, dfl = 2, + SGD  top-k = 12 wise_iou_v3
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
    all       3930       2271      0.878      0.834      0.878      0.522      0.855
    -----------------------------------------------------------------------------------------
    一样的参数，图像尺寸640x640
    Class     Images  Instances      Box(P      R      mAP50   mAP50-95    F1)
    all       3930       2271        0.872     0.843   0.88      0.529  0.857
    -----------------------------------------------------------------------------------------
  - DINE_DEIM 实验(640x640 默认参数)
     Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.551
     Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.867   *
     Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.586
     Average Precision  (AP) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.305
     Average Precision  (AP) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.457
     Average Precision  (AP) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.575
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=  1 ] = 0.574
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets= 10 ] = 0.702
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.800
     Average Recall     (AR) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.550
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.711
     Average Recall     (AR) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.822
     Average Recall     (AR) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.985   *
     Average Recall     (AR) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.905

- 8月13号：新数据集测试结果

  - 收集霾、和云雾、雨的样本（新数据集）
    YOLO11x-cbam summary (fused): 210 layers, 58,748,187 parameters, 0 gradients, 196.0 GFLOPs（颈部添加CBAM）
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
    all       4673       2540         0.874      0.816      0.867      0.502      0.844
    Results saved to runs/smoke_train/YOLO11-X-768-WIOU_v3-Assigner2-SGD-CBAM-NewDataSet3
    -----------------------------------------------------------------------------------
    YOLO11x summary (fused): 190 layers, 56,828,179 parameters, 0 gradients, 194.4 GFLOPs （没有CBAM）
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
    all       4673       2540      0.888      0.846      0.887      0.574      0.867
    Results saved to runs/smoke_train/YOLO11-X-768-WIOU_v3-Assigner2-SGD-NewDataSet
    ------------------------------------------------------------------------------------
    调了数据增强的概率0.1->0.2。wise-iou 其他参数默认 768x768
    YOLO11x summary (fused): 190 layers, 56,828,179 parameters, 0 gradients, 194.4 GFLOPs
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
    all       4673       2540      0.891      0.839       0.89      0.568      0.864
    Results saved to runs/smoke_train/YOLO11-X-768-WIOU_v3-Assigner2-SGD-NewDataSet-Abum12
    -----------------------------------------------------------------------------------
    在上面参数基础上，调整 样本分配策略（alpha is 1.0 beta is 5.5 top-K is 10）
    YOLO11x summary (fused): 190 layers, 56,828,179 parameters, 0 gradients, 194.4 GFLOPs   
    Class     Images  Instances      Box(P          R       mAP50   mAP50-95        F1): 
    all       4673       2540         0.898      0.843      0.895      0.568       0.87
    Results saved to runs/smoke_train/YOLO11-X-768-TAL
    --------------------------------------------------------------------------------------
    损失函数变为C-IOU
    YOLO11x summary (fused): 190 layers, 56,828,179 parameters, 0 gradients, 194.4 GFLOPs
    Class     Images  Instances      Box(P        R      mAP50   mAP50-95        F1): 
    all       4673       2540      0.889        0.856      0.899      0.584      0.872
    ---------------------------------------------------------------------------------------
    Results saved to runs/smoke_train/YOLO11-X-768-CIOU
    开启WBF融合 F1:85.63
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   smoke   | 2194.0 | 389.0 |       2541      | 0.1506 | 0.8634 | 0.8769 |
    |           |        |       |                 |        |        |        |
    |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.69% |
    | precision |   -    |   -   |        -        |   -    |   -    | 84.94% |
    |   recall  |   -    |   -   |        -        |   -    |   -    | 86.34% |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    开启NMS F1：85.26
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   smoke   | 2229.0 | 459.0 |       2541      | 0.1708 | 0.8772 | 0.8852 |
    |           |        |       |                 |        |        |        |
    |    mAP    |   -    |   -   |        -        |   -    |   -    | 88.52% |
    | precision |   -    |   -   |        -        |   -    |   -    | 82.92% |
    |   recall  |   -    |   -   |        -        |   -    |   -    | 87.72% |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    -----------------------------------------------------------------------------------
    YOLOV12训练结果 Wise_IOU  box = 7, cls = 1, dfl = 2, 其他默认参数 640x640
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95     F1): 
    all       4673       2540         0.88      0.853      0.885      0.584     0.866
    runs/smoke_train/YOLO12-X-640-WIOU_v3-Assigner2-SGD-NewDataSet
    ----------------------------------------------------------------------------------
    在上面参数基础上，调整 样本分配策略（alpha is 1.0 beta is 5.5 top-K is 10）图像分辨率-》768 
    YOLOv12x summary (fused): 283 layers, 59,044,499 parameters, 0 gradients, 198.5 GFLOPs
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
     all       4673       2540        0.885      0.859      0.902      0.575      0.872
    runs/smoke_train/YOLO12-X-640-WIOU_v3-Assigner2-SGD-NewDataSet3
    -----------------------------------------------------------------------------------------
    混合精度训练，模型尺寸L
    YOLOv12l summary (fused): 283 layers, 26,339,843 parameters, 0 gradients
    Class     Images  Instances    Box(P        R      mAP50   mAP50-95        F1)
    all       4673       2540      0.884      0.864      0.899      0.584     0.874
    Results saved to runs/smoke_train/YOLO12-L-768-CIOU-AMP
    -------------------------------------------------------------------------------------------
    YOLOv12l summary (fused): 283 layers, 26,339,843 parameters, 0 gradients, 88.5 GFLOPs
    Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1): 
    all       4673       2540      0.888      0.871      0.902      0.605      0.879            **************************
    Speed: 0.0ms preprocess, 4.3ms inference, 0.0ms loss, 0.3ms postprocess per image
    Results saved to runs/smoke_train/YOLO12-L-768-WIOU-AMP_false-Step_lr2
    ----------------------------------------------------------------------------------------------
    WBF融合 86.85
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   smoke   | 2216.0 | 346.0 |       2541      | 0.1351 | 0.8721 | 0.8881 |
    |           |        |       |                 |        |        |        |
    |    mAP    |   -    |   -   |        -        |   -    |   -    | 88.81% |
    | precision |   -    |   -   |        -        |   -    |   -    | 86.49% |
    |   recall  |   -    |   -   |        -        |   -    |   -    | 87.21% |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    不开融合 86.17
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    |   smoke   | 2242.0 | 421.0 |       2541      | 0.1581 | 0.8823 | 0.8888 |
    |           |        |       |                 |        |        |        |
    |    mAP    |   -    |   -   |        -        |   -    |   -    | 88.88% |
    | precision |   -    |   -   |        -        |   -    |   -    | 84.19% |
    |   recall  |   -    |   -   |        -        |   -    |   -    | 88.23% |
    +-----------+--------+-------+-----------------+--------+--------+--------+
    -------------------------------------------------------------------------------------
     DEIM-DFINE实验结果
     Average Precision  (AP) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.536
     Average Precision  (AP) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.862
     Average Precision  (AP) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.578
     Average Precision  (AP) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.270
     Average Precision  (AP) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.428
     Average Precision  (AP) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.563
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=  1 ] = 0.554
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets= 10 ] = 0.682
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=   all | maxDets=100 ] = 0.768
     Average Recall     (AR) @[ IoU=0.50:0.95 | area= small | maxDets=100 ] = 0.553
     Average Recall     (AR) @[ IoU=0.50:0.95 | area=medium | maxDets=100 ] = 0.690
     Average Recall     (AR) @[ IoU=0.50:0.95 | area= large | maxDets=100 ] = 0.786
     Average Recall     (AR) @[ IoU=0.50      | area=   all | maxDets=100 ] = 0.988
     Average Recall     (AR) @[ IoU=0.75      | area=   all | maxDets=100 ] = 0.886

     保存在： /data1/home/lwx/work/Code/Experiment/JY_DEIM_RAW/output2/best_stg2.pth
      nms_iou=0.7 conf=0.25
      +-----------+--------+--------+-----------------+--------+--------+--------+
      |   Class   |   TP   |   FP   | total positives |  FPR   | Recall |   AP   |
      +-----------+--------+--------+-----------------+--------+--------+--------+
      |   smoke   | 2305.0 | 1060.0 |       2541      | 0.3150 | 0.9071 | 0.8774 |
      |           |        |        |                 |        |        |        |
      |    mAP    |   -    |   -    |        -        |   -    |   -    | 87.74% |
      | precision |   -    |   -    |        -        |   -    |   -    | 68.50% |
      |   recall  |   -    |   -    |        -        |   -    |   -    | 90.71% |
      +-----------+--------+--------+-----------------+--------+--------+--------+
      nms_iou=0.7 conf=0.35
      +-----------+--------+-------+-----------------+--------+--------+--------+
      |   Class   |   TP   |   FP  | total positives |  FPR   | Recall |   AP   |
      +-----------+--------+-------+-----------------+--------+--------+--------+
      |   smoke   | 2196.0 | 464.0 |       2541      | 0.1744 | 0.8642 | 0.8700 |
      |           |        |       |                 |        |        |        |
      |    mAP    |   -    |   -   |        -        |   -    |   -    | 87.00% |
      | precision |   -    |   -   |        -        |   -    |   -    | 82.56% |
      |   recall  |   -    |   -   |        -        |   -    |   -    | 86.42% |
      +-----------+--------+-------+-----------------+--------+--------+--------+
     ------------------------------------------------------------------------------------
     DETR-V2测试结果，epoch=100, box = 7,cls = 1, dfl = 2
     Class     Images  Instances      Box(P          R      mAP50   mAP50-95        F1)
     all       4673       2540         0.836      0.802      0.839       0.48      0.819




## 文中链接

[DFL](https://medium.com/@elvenkim1/dual-focal-loss-dfl-in-yolo-colab-0c9ac722f917)
![烟雾检测最主要的问题](000937.jpg)
![WBF](wbf_vis.jpg)
[Wise-IoU](https://blog.csdn.net/shilichangtin/article/details/135214324?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-135214324-blog-128888122.235^v43^pc_blog_bottom_relevance_base5&spm=1001.2101.3001.4242.2&utm_relevant_index=4)
